# 삼국지 영걸전 얼굴 디코더 (face-decoder.ts)

## 개요

삼국지 영걸전(三國志英傑傳, 1995)의 얼굴 이미지는 **TF-DCE (Takayuki Fujinuma graphic Data Compress & Expand)** 압축 형식을 사용합니다.

### 기본 사양

| 항목 | 값 |
|------|-----|
| 이미지 크기 | 64 × 80 픽셀 |
| 색상 수 | 8색 (3비트) |
| 비트 플레인 수 | 3개 (Plane 0, 1, 2) |
| 플레인당 크기 | 640 바이트 |
| 총 출력 크기 | 1920 바이트 |
| 총 이미지 수 | 240개 |

## 사용법

```sh
# 전체 얼굴 렌더링
$ npx ts-node decode-faces.ts

# 결과: faces.png (1280×960, 240개 얼굴)
```

## 모듈

| 파일 | 설명 |
|------|------|
| `face-decoder.ts` | 디코더 모듈 (decodeFace, decodeFaces export) |
| `decode-faces.ts` | 배치 실행 스크립트 |

## 파일 구조

```
┌─────────────────────────────────────┐
│ 고정 헤더 (10 바이트)                │
│ - byte 7: 플레인 순서 코드           │
│ - byte 9: 룩업 테이블 엔트리 수 (N)   │
├─────────────────────────────────────┤
│ 명령어 룩업 테이블 (N × 2 바이트)     │
├─────────────────────────────────────┤
│ 압축 데이터                          │
└─────────────────────────────────────┘
```

### 플레인 순서 (Byte 7)

| 값 | 플레인 순서 |
|----|-------------|
| 0xC6 | [0, 1, 2] |
| 0xC9 | [1, 0, 2] |
| 0xD2 | [0, 2, 1] |
| 0xD8 | [2, 0, 1] |
| 0xE1 | [1, 2, 0] |
| 0xE4 | [2, 1, 0] |

### 명령어 체계

| 범위 | 분류 | 설명 |
|------|------|------|
| 0x00-0x1F | 헤더 테이블 참조 | 룩업 테이블에서 서브명령어 실행 |
| 0x20-0x2F | 백레퍼런스 | 선형 버퍼에서 복사 |
| 0x30-0x3F | VGA 플레인 읽기 | 이전 플레인에서 읽기 + 회전 |
| 0x40-0x4F | VGA 백레퍼런스 | VGA 주소 기반 복사 |
| 0x50-0x5F | 플레인 읽기 + 마스킹 | 캐시 패턴으로 마스킹 |
| 0x60-0x6F | 2바이트 패턴 반복 | 패턴 반복 출력 |
| 0x70-0x7F | 리터럴 복사 | 원본 데이터 그대로 출력 |
| 0x80-0x8F | 니블 회전 패턴 | 특수 패턴 생성 |
| 0x90-0x9F | 확장 명령어 | 다양한 서브명령어 |
| 0xA0-0xFF | RLE | 단일 바이트 반복 |

### VGA 지그재그 스캔

```
열 0: 행 0→79  (위→아래)
열 1: 행 79→0  (아래→위)
열 2: 행 0→79  (위→아래)
...
```

## 스크린샷

![hero-faces](../output/hero-faces.png)
